<html>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="prism.css">
<link rel="stylesheet" href="extra_style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="prism.js"></script>

<body>

<!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="home.html">Data Analysis Curriculum</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="home.html">Home</a></li>
            <li><a href="setup.html">Getting Set Up</a></li>
            <li><a href="resources.html">Other Resources</a></li>
            <li><a href="about.html">About</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Modules <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="q1.html">1: Data Manipulation</a></li>
                <li><a href="#">2: Visualization</a></li>
                <li><a href="#">3: Data Structures</a></li>
              </ul>
            </li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

<div id="topspace"><br><br><br><br></div>

<div class="container">
	<h1> Question 1 </h1>
	<h3> Math and Statistics Calculations </h3>
</div>

<br>
<div class="container"> <a href="q1_answers.xlsx">download Q1 answer sheet</a></div>
<br>

<!-- PART A ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

<div class="container"><p class="q"> A: What is the average annual GDP per capita of Argentina from 2005 through 2016?</p></div>

<br>

<div class="container">
  <p><i>Solutions (click to expand)</i></p>
  <div class="panel-group">
    
    <!-- Excel -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseA1">Excel</a></h4>
      </div>
      <div id="collapseA1" class="panel-collapse collapse">
		    <pre><code class="language-javascript">
=AVERAGE(GDP.PCAP!AZ9:BK9)</code></pre>
	    </div>
    </div>

    <!-- SQL -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseA2">SQL</a></h4>
      </div>
      <div id="collapseA2" class="panel-collapse collapse">
        <pre><code class="language-javascript">
select avg(gdp_pcap)
from gdp_pcap
where region_name = 'Argentina'
and year between 2005 and 2016</code></pre>
      </div>
    </div>

    <!-- R -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseA3">R</a></h4>
      </div>
      <div id="collapseA3" class="panel-collapse collapse">
        <pre><code class="language-javascript"> 
set = gdp$region_name == 'Argentina' & gdp$year >= 2005 & gdp$year <= 2016
mean( gdp$gdp_pcap[ set ] )</code></pre>
      </div>
    </div>

  </div>

</div>

<!-- PART B ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    
<div class="container"><p class="q"> B: What is the maximum % of Public Expenditure on health for any recorded year in Chile? </p></div>

<br>

<div class="container">
  <p><i>Solutions (click to expand)</i></p>
  <div class="panel-group">
    
    <!-- Excel -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseB1">Excel</a></h4>
      </div>
      <div id="collapseB1" class="panel-collapse collapse">
        <pre><code class="language-javascript">
=MAX(HEALTH!F39:BH39)</code></pre>
      </div>
    </div>

    <!-- SQL -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseB2">SQL</a></h4>
      </div>
      <div id="collapseB2" class="panel-collapse collapse">
        <pre><code class="language-javascript">
select max(health_exp)
from health_exp
where region_name = 'Chile'</code></pre>
      </div>
    </div>

    <!-- R -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseB3">R</a></h4>
      </div>
      <div id="collapseB3" class="panel-collapse collapse">
        <pre><code class="language-javascript"> 
max( health$health_exp[ health$region_name=='Chile' ], na.rm=T )</code></pre>
      </div>
    </div>

  </div>

</div>

<!-- PART C ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    
<div class="container"><p class="q"> C: What would you expect a transatlantic, working, married couple from Canada and Belgium to be earning annually in 2016? </p></div>

<br>

<div class="container">
  <p><i>Solutions (click to expand)</i></p>
  <div class="panel-group">
    
    <!-- Excel -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseC1">Excel</a></h4>
      </div>
      <div id="collapseC1" class="panel-collapse collapse">
        <pre><code class="language-javascript">
=SUM(GDP.PCAP!BK35,GDP.PCAP!BK17)</code></pre>
      </div>
    </div>

    <!-- SQL -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseC2">SQL</a></h4>
      </div>
      <div id="collapseC2" class="panel-collapse collapse">
        <pre><code class="language-javascript">
select sum(gdp_pcap)
from gdp_pcap
where region_name in ('Belgium','Canada')
and year = 2016</code></pre>
      </div>
    </div>

    <!-- R -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseC3">R</a></h4>
      </div>
      <div id="collapseC3" class="panel-collapse collapse">
        <pre><code class="language-javascript"> 
sum( gdp$gdp_pcap[ gdp$year == 2016 & gdp$region_name %in% c('Belgium', 'Canada') ] )</code></pre>
      </div>
    </div>

  </div>
</div>

<!-- PART D ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    
<div class="container"><p class="q"> D: What is the median rural population among all countries in the world in 2010 vs. 2016? </p></div>

<br>

<div class="container">
  <p><i>Solutions (click to expand)</i></p>
  <div class="panel-group">
    
    <!-- Excel -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseD1">Excel</a></h4>
      </div>
      <div id="collapseD1" class="panel-collapse collapse">
        <pre><code class="language-javascript">
=MEDIAN(RUR.POP!BD2:BD265) // 2010
=MEDIAN(RUR.POP!BJ2:BJ265) // 2016
</code></pre>
      </div>
    </div>

    <!-- SQL -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseD2">SQL</a></h4>
      </div>
      <div id="collapseD2" class="panel-collapse collapse">
        <pre><code class="language-javascript">
// Median is not easy with SQL...</code></pre>
      </div>
    </div>

    <!-- R -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseD3">R</a></h4>
      </div>
      <div id="collapseD3" class="panel-collapse collapse">
        <pre><code class="language-javascript"> 
v1 = median( pop$rural_pop[ pop$year==2010 ], na.rm=T )
v2 = median( pop$rural_pop[ pop$year==2016 ], na.rm=T )
c(v1, v2)</code></pre>
      </div>
    </div>

  </div>
</div>

  <!-- PART E1 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    
<div class="container"><p class="q"> E1: What is the average % of Public Expenditure on health in 2014? </p></div>

<br>

<div class="container">
  <p><i>Solutions (click to expand)</i></p>
  <div class="panel-group">
    
    <!-- Excel -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseE11">Excel</a></h4>
      </div>
      <div id="collapseE11" class="panel-collapse collapse">
        <pre><code class="language-javascript">
=AVERAGE(HEALTH!BH2:BH265)</code></pre>
      </div>
    </div>

    <!-- SQL -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseE12">SQL</a></h4>
      </div>
      <div id="collapseE12" class="panel-collapse collapse">
        <pre><code class="language-javascript">
select avg(health_exp)
from health_exp
where year = 2014</code></pre>
      </div>
    </div>

    <!-- R -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseE13">R</a></h4>
      </div>
      <div id="collapseE13" class="panel-collapse collapse">
        <pre><code class="language-javascript"> 
mean( health$health_exp[ health$year==2014 ], na.rm=T )</code></pre>
      </div>
    </div>

  </div>
</div>

  <!-- PART E2 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    
<div class="container"><p class="q"> E2: What is the average % of Public Expenditure on health in 2014, weighted by Rural Population in the same year? </p></div>

<br>

<div class="container">
  <p><i>Solutions (click to expand)</i></p>
  <div class="panel-group">
    
    <!-- Excel -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseE21">Excel</a></h4>
      </div>
      <div id="collapseE21" class="panel-collapse collapse">
        <pre><code class="language-javascript">
=SUMPRODUCT(HEALTH!BH2:BH265,RUR.POP!BH2:BH265)/SUM(RUR.POP!BH2:BH265)</code></pre>
      </div>
    </div>

    <!-- SQL -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseE22">SQL</a></h4>
      </div>
      <div id="collapseE22" class="panel-collapse collapse">
        <pre><code class="language-javascript">
select sum(rp.rural_pop * he.health_exp)/sum(rp.rural_pop)
from rural_pop rp
join health_exp he 
  on he.region_code = rp.region_code 
  and he.year = rp.year
where rp.year = 2014</code></pre>
      </div>
    </div>

    <!-- R -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseE23">R</a></h4>
      </div>
      <div id="collapseE23" class="panel-collapse collapse">
        <pre><code class="language-javascript"> 
sum(health$health_exp[health$year==2014] * pop$rural_pop[pop$year==2014], na.rm=T ) / 
  sum( pop$rural_pop[pop$year==2014], na.rm=T ) 

// above only works if the tables health and pop have all countries in the same order. In case they don't:
// first, merge the two tables accordingly
new = merge(health, pop, by=c("region_code", "year"))

// but wait, many of the columns got duplicated...
names(new)

// try again, now specifying only the new columns you want from the population table
new = merge(health, pop[,c("region_code","year","rural_pop")], by=c("region_code", "year"))

// and calculate
sum(new$health_exp[new$year==2014] * new$rural_pop[new$year==2014], na.rm=T ) / 
  sum( new$rural_pop[new$year==2014], na.rm=T ) </code></pre>
      </div>
    </div>

  </div>
</div>

  <!-- PART F ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    
<div class="container"><p class="q"> F: What was the standard deviation of % health expenditure among all countries and regions in 2014? </p></div>

<br>

<div class="container">
  <p><i>Solutions (click to expand)</i></p>
  <div class="panel-group">
    
    <!-- Excel -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseF1">Excel</a></h4>
      </div>
      <div id="collapseF1" class="panel-collapse collapse">
        <pre><code class="language-javascript">
=STDEV(HEALTH!BH3:BH265)</code></pre>
      </div>
    </div>

    <!-- SQL -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseF2">SQL</a></h4>
      </div>
      <div id="collapseF2" class="panel-collapse collapse">
        <pre><code class="language-javascript">
select std(health_exp)
from health_exp
where year = 2014</code></pre>
      </div>
    </div>

    <!-- R -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseF3">R</a></h4>
      </div>
      <div id="collapseF3" class="panel-collapse collapse">
        <pre><code class="language-javascript"> 
sd( health$health_exp[ health$year == 2014 ] , na.rm=T)</code></pre>
      </div>
    </div>

  </div>
</div>

  <!-- PART G ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    
<div class="container"><p class="q"> G: What is the 25th, 50th, and 75th percentiles of % health expenditure among all countries and regions in 2014? </p></div>

<br>

<div class="container">
  <p><i>Solutions (click to expand)</i></p>
  <div class="panel-group">
    
    <!-- Excel -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseG1">Excel</a></h4>
      </div>
      <div id="collapseG1" class="panel-collapse collapse">
        <pre><code class="language-javascript">
=PERCENTILE.INC(HEALTH!$BH$3:$BH$265,0.25) // 25th percentile
=PERCENTILE.INC(HEALTH!$BH$3:$BH$265,0.5)  // 50th percentile (median)
=PERCENTILE.INC(HEALTH!$BH$3:$BH$265,0.75) // 75th percentile</code></pre>
      </div>
    </div>

    <!-- SQL -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseG2">SQL</a></h4>
      </div>
      <div id="collapseG2" class="panel-collapse collapse">
        <pre><code class="language-javascript">
// These are just other versions of median, still not easy in SQL...</code></pre>
      </div>
    </div>

    <!-- R -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseG3">R</a></h4>
      </div>
      <div id="collapseG3" class="panel-collapse collapse">
        <pre><code class="language-javascript"> 
quantile( health$health_exp[ health$year == 2014 ], p, na.rm=T )</code></pre>
      </div>
    </div>

  </div>
</div>

  <!-- PART H ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    
<div class="container"><p class="q"> H: What is the correlation between Rural Population and % spent on healthcare in the following countries for 2000-2014? <br> Zimbabwe, Sweden, Philippines </p></div>

<br>

<div class="container">
  <p><i>Solutions (click to expand)</i></p>
  <div class="panel-group">
    
    <!-- Excel -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseH1">Excel</a></h4>
      </div>
      <div id="collapseH1" class="panel-collapse collapse">
        <pre><code class="language-javascript">
=CORREL(HEALTH!AT265:BH265,RUR.POP!AT265:BH265) // Zimbabwe
=CORREL(HEALTH!AT223:BH223,RUR.POP!AT223:BH223) // Sweden
=CORREL(HEALTH!AT187:BH187,RUR.POP!AT187:BH187) // Philippines</code></pre>
      </div>
    </div>

    <!-- SQL -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseH2">SQL</a></h4>
      </div>
      <div id="collapseH2" class="panel-collapse collapse">
        <pre><code class="language-javascript">
// Not Easy...but here it is. Come back to this later if you'd like.
// MySQL does not have a correlation function (like it does for average, or standard deviation)
// Remember, sample correlation coefficient equation: https://wikimedia.org/api/rest_v1/media/math/render/svg/bd1ccc2979b0fd1c1aec96e386f686ae874f9ec0

select region_name, p1 / (sqrt(p2)*sqrt(p3)) as correl_coef
from (
select 
  region_name, 
  sum((x-xbar)*(y-ybar)) as p1,
  sum(power(x-xbar,2)) as p2,
  sum(power(y-ybar,2)) as p3
from (
select 
  rp.region_name, 
  rp.rural_pop as x, 
  x.avg_pop as xbar, 
  he.health_exp as y, 
  x.avg_health as ybar
from rural_pop rp
join health_exp he on he.region_code = rp.region_code and he.year = rp.year
join (
  select 
    rp.region_name,
    avg(rp.rural_pop) as avg_pop, 
    avg(he.health_exp) as avg_health 
  from rural_pop rp
  join health_exp he 
    on he.region_code = rp.region_code 
    and he.year = rp.year
  where rp.region_name in ('Zimbabwe', 'Sweden', 'Philippines')
  and rp.year between 2000 and 2014
  group by rp.region_name
) x on x.region_name = rp.region_name
where rp.region_name in ('Zimbabwe', 'Sweden', 'Philippines')
and rp.year between 2000 and 2014
order by rp.region_name
) y
group by region_name
) z</code></pre>
      </div>
    </div>

    <!-- R -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseH3">R</a></h4>
      </div>
      <div id="collapseH3" class="panel-collapse collapse">
        <pre><code class="language-javascript"> 
new = merge( health[ ,c("region_name","year","health_exp") ], 
             pop[ ,c("region_name","year","rural_pop") ], 
             by = c("region_name", "year") 
)
new = new[new$region_name %in% c('Zimbabwe', 'Sweden', 'Philippines'), ]   # only certain countries 
new = new[new$year >= 2000 & new$year <= 2014, ]                           # only certain years
new = new[ is.na(new$health_exp)==FALSE & is.na(new$rural_pop)==FALSE, ]   # only full records
cor(new$rural_pop, new$health_exp)</code></pre>
      </div>
    </div>

  </div>
</div>

  <!-- PART I ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    
<div class="container"><p class="q"> I: What is the correlation between Rural Population and % spent on healthcare over all countries for 2000-2014? </p></div>

<br>

<div class="container">
  <p><i>Solutions (click to expand)</i></p>
  <div class="panel-group">
    
    <!-- Excel -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseI1">Excel</a></h4>
      </div>
      <div id="collapseI1" class="panel-collapse collapse">
        <pre><code class="language-javascript">
=CORREL(HEALTH!AT2:BH265,RUR.POP!AT2:BH265)</code></pre>
      </div>
    </div>

    <!-- SQL -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseI2">SQL</a></h4>
      </div>
      <div id="collapseI2" class="panel-collapse collapse">
        <pre><code class="language-javascript">
// Similar as above. Need to implement on our own the correlation formula

select p1 / (sqrt(p2)*sqrt(p3)) as correl_coef
from (
select 
  sum((x-xbar)*(y-ybar)) as p1,
  sum(power(x-xbar,2)) as p2,
  sum(power(y-ybar,2)) as p3
from (
select 
  rp.rural_pop as x, 
  x.avg_pop as xbar, 
  he.health_exp as y, 
  x.avg_health as ybar
from rural_pop rp
join health_exp he on he.region_code = rp.region_code and he.year = rp.year
cross join (
  select 
    avg(rp.rural_pop) as avg_pop, 
    avg(he.health_exp) as avg_health 
  from rural_pop rp
  join health_exp he 
    on he.region_code = rp.region_code 
    and he.year = rp.year
  where rp.year between 2000 and 2014
) x 
where rp.year between 2000 and 2014
) y
) z</code></pre>
      </div>
    </div>

    <!-- R -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><a data-toggle="collapse" href="#collapseI3">R</a></h4>
      </div>
      <div id="collapseI3" class="panel-collapse collapse">
        <pre><code class="language-javascript"> 
new = merge( health[ ,c("region_name","year","health_exp") ], 
             pop[ ,c("region_name","year","rural_pop") ], 
             by = c("region_name", "year") 
)
new = new[new$year >= 2000 & new$year <= 2014, ]                           # only certain years
new = new[ is.na(new$health_exp)==FALSE & is.na(new$rural_pop)==FALSE, ]   # only full records
cor(new$rural_pop, new$health_exp)</code></pre>
      </div>
    </div>

  </div>
</div>

<div class="container"> <a href="#topspace">return to top</a></div>
<div class="container"> <a href="q1_answers.xlsx">download Q1 answer sheet</a></div>
<br><br><br><br>

</body>
</html>
